<!-- Navbar -->
<nav class="navbar">
  <div class="left">
    <img
      src="assets/user-profile.png"
      alt="Perfil"
      routerLink="/dashteste"
      class="profile-img"
    />
    <div class="greeting">
      <div>Olá, {{ usuarioService.nomeUsuario || "..." }}</div>
      <small>{{ dataHoje }}</small>
    </div>
  </div>
  <div class="right">
    <div
      class="notificacao-wrapper"
      (mouseenter)="abrirNotificacao()"
      (mouseleave)="fecharNotificacao()"
    >
      <img
        src="assets/notificacao.png"
        alt="Notificações"
        class="notificacao"
      />
      <div class="notificacao-popup" *ngIf="mostrarNotificacoes">
        <div *ngFor="let n of notificacoes" class="notificacao-card">
          <div class="notificacao-imagem">
            <img [src]="n.imagemUrl" alt="Imagem" />
          </div>
          <div class="notificacao-conteudo">
            <strong>{{ n.titulo }}</strong>
            <small>{{ n.descricao }}</small>
          </div>
          <div
            *ngIf="usuarioService.usuarioEhAdmin()"
            style="
              display: flex;
              align-items: center;
              gap: 0.3rem;
              margin-left: auto;
            "
          >
            <span
              class="editar-notificacao"
              title="Editar notificação"
              style="cursor: pointer; font-size: 18px"
              (click)="editarNotificacao(n)"
              >✎</span
            >
            <span
              class="apagar-notificacao"
              title="Remover notificação"
              style="cursor: pointer; font-size: 18px"
              (click)="confirmarRemocao(n)"
              >✕</span
            >
          </div>
        </div>
        <div
          class="nova-notificacao"
          *ngIf="usuarioService.usuarioEhAdmin()"
          (click)="abrirFormularioNotificacao()"
        >
          + Nova notificação
        </div>
      </div>
    </div>
    <div
      class="dropdown"
      (mouseenter)="abrirMenu()"
      (mouseleave)="fecharMenu()"
    >
      <div class="dropdown-toggle">☰</div>
      <ul class="dropdown-menu" *ngIf="menuAberto">
        <li><a routerLink="/menu">Perfil</a></li>
        <li><a routerLink="/galeria">Galeria</a></li>
        <li><a routerLink="/produtos">Produtos</a></li>
        <li><a routerLink="/meus-horarios">Meus Horários</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Formulário de Notificação -->
<div
  class="formulario-modal"
  *ngIf="mostrarFormulario"
  style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 12px;
    z-index: 999;
    width: 400px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  "
>
  <h3 style="color: black; margin-top: 0">Nova Notificação</h3>
  <input
    type="text"
    [(ngModel)]="nova.titulo"
    class="form-control"
    placeholder="Título da notificação"
    style="width: 100%"
  />
  <textarea
    [(ngModel)]="nova.descricao"
    class="form-control"
    placeholder="Descrição da notificação"
    style="width: 100%; resize: none"
    rows="3"
  ></textarea>
  <input style="color: black" type="file" (change)="onFileChange($event)" />
  <div class="botoes-container">
    <button class="cancelar" (click)="cancelarFormulario()">Cancelar</button>
    <button
      class="salvar"
      (click)="salvarNotificacao()"
      [disabled]="
        !nova.titulo.trim() || !nova.descricao.trim() || !nova.imagemUrl
      "
    >
      Salvar
    </button>
  </div>
</div>

<!-- Formulário de Edição -->
<div
  class="formulario-modal"
  *ngIf="mostrarFormularioEdicao"
  style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 20px;
    border-radius: 12px;
    z-index: 999;
    width: 400px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  "
>
  <h3 style="color: black; margin-top: 0">Editar Agendamento</h3>
  <div style="margin-bottom: 10px">
    <label style="color: black">Barbeiro:</label>
    <select [(ngModel)]="barbeiroSelecionado" style="width: 100%">
      <option *ngFor="let barbeiro of barbeiros" [value]="barbeiro">
        {{ barbeiro }}
      </option>
    </select>
  </div>
  <div style="margin-bottom: 10px">
    <label style="color: black">Serviços:</label>
    <div *ngFor="let servico of servicos">
      <label>
        <input
          type="checkbox"
          [checked]="servicosSelecionados.includes(servico.id!)"
          (change)="toggleServico(servico.id!, $event)"
        />
        {{ servico.nome }} (R$ {{ servico.preco.toFixed(2) }})
      </label>
    </div>
  </div>
  <div style="margin-bottom: 10px">
    <label style="color: black">Data:</label>
    <input
      type="date"
      [(ngModel)]="dataSelecionada"
      (change)="carregarHorarios()"
      style="width: 100%"
    />
  </div>
  <div style="margin-bottom: 10px">
    <label style="color: black">Horário:</label>
    <select [(ngModel)]="horarioSelecionado" style="width: 100%">
      <option
        *ngFor="let horario of horarios"
        [value]="horario.horario"
        [disabled]="horario.bloqueado"
      >
        {{ formatarHorario(horario.horario) }}
        {{ horario.bloqueado ? "(Indisponível)" : "" }}
      </option>
    </select>
  </div>
  <div class="botoes-container">
    <button class="cancelar" (click)="cancelarFormularioEdicao()">
      Cancelar
    </button>
    <button
      class="salvar"
      (click)="salvarEdicao()"
      [disabled]="
        !servicosSelecionados.length || !dataSelecionada || !horarioSelecionado
      "
    >
      Salvar
    </button>
  </div>
</div>

<!-- Conteúdo Principal -->
<div class="container-agendamentos">
  <h2>Meus Agendamentos</h2>
  <div class="agendamentos-lista">
    <div *ngIf="agendamentos.length === 0" class="sem-agendamentos">
      <p>Nenhum agendamento encontrado.</p>
    </div>
    <div *ngFor="let agendamento of agendamentos" class="agendamento-card">
      <div class="linha">
        <strong>Status:</strong>
        <b
          ><span [ngStyle]="{ color: corStatus(agendamento.status || '') }">
            {{ agendamento.status || "" }}
          </span></b
        >
      </div>
      <div class="linha">
        <strong>Barbeiro:</strong>
        <span>{{ agendamento.barbeiro || "Sem Preferência" }}</span>
      </div>
      <div class="linha">
        <strong>Serviços:</strong>
        <span>{{ obterNomesServicos(agendamento) }}</span>
      </div>
      <div class="linha">
        <strong>Data e horário:</strong>
        <span>{{ agendamento.data }} às {{ agendamento.horario }}</span>
      </div>
      <div class="linha">
        <strong>Subtotal:</strong>
        <span>R$ {{ agendamento.subtotal.toFixed(2) }}</span>
      </div>
      <!-- <div class="linha">
        <strong>Cupom:</strong>
        <span>{{ agendamento.cupomNome || "Nenhum" }}</span>
      </div>
      <div class="linha">
        <strong>Desconto:</strong>
        <span>- R$ {{ agendamento.desconto.toFixed(2) }}</span>
      </div> -->
      <div class="linha">
        <strong>Total:</strong>
        <span>R$ {{ agendamento.total.toFixed(2) }}</span>
      </div>
      <div
        class="botoes-agendamento"
        *ngIf="
          (usuarioService.usuarioEhAdmin() ||
            agendamento.usuarioId ===
              usuarioService.getUsuarioLogadoSnapshot()?.id) &&
          isEditableOrCancelable(
            agendamento.status || '',
            agendamento.data,
            agendamento.horario
          )
        "
      >
        <button
          class="editar-agendamento"
          (click)="abrirFormularioEdicao(agendamento)"
        >
          Editar
        </button>
        <button
          class="cancelar-agendamento"
          (click)="confirmarRemocaoAgendamento(agendamento.id!)"
        >
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>
<br /><br /><br /><br /><br /><br />

<!-- BARRA INFERIOR MOBILE -->
<div class="bottom-nav">
  <a routerLink="/dashboard" class="nav-item">
    <img src="assets/inicio.png" alt="Início" width="38px" height="32px" />
    <span>Início</span>
  </a>
  <a routerLink="/galeria" class="nav-item">
    <img src="assets/galeria.png" alt="Galeria" width="34px" height="33px" />
    <span>Galeria</span>
  </a>
  <a routerLink="/agendamento" class="nav-item">
    <img
      src="assets/agendamento.png"
      alt="Agendamentos"
      width="34px"
      height="34px"
    />
    <span>Agendamentos</span>
  </a>
  <a routerLink="/produtos" class="nav-item">
    <img src="assets/produto.png" alt="Produtos" width="30px" height="30px" />
    <span>Produtos</span>
  </a>
  <a class="nav-item" (click)="abrirMenuMobile()">
    <img src="assets/user-profile.png" alt="Menu" width="40px" height="40px" />
    <span>Menu</span>
  </a>

  <!-- POP-UP DE MENU MOBILE -->
  <div class="menu-mobile-popup" *ngIf="mostrarMenuMobile">
    <div class="menu-mobile-content">
      <button class="fechar-menu-mobile" (click)="fecharMenuMobile()">✕</button>
      <ul class="menu-mobile-lista">
        <li><a routerLink="/menu" (click)="fecharMenuMobile()">Perfil</a></li>
        <li>
          <a
            routerLink="/meus-horarios"
            (click)="fecharMenuMobile()"
            style="color: #f46d25"
            >Meus horarios</a
          >
        </li>
        <li><a (click)="logout(); fecharMenuMobile()">Sair</a></li>
      </ul>
    </div>
  </div>
</div>
