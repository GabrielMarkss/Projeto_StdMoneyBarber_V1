<!-- NAVBAR SUPERIOR -->
<nav class="navbar" id="navbar">
  <div class="left" style="display: flex; align-items: center">
    <img
      src="assets/user-profile.png"
      alt="Perfil"
      routerLink="/dashteste"
      class="profile-img"
    />
    <div class="greeting">
      <div>Olá, {{ usuarioService.nomeUsuario || "..." }}</div>
      <small>{{ dataHoje }}</small>
    </div>
  </div>

  <div
    class="right"
    style="
      display: flex;
      align-items: flex-end;
      gap: 0.5rem;
      padding-bottom: 0.25px;
      margin-top: 20px;
    "
  >
    <!-- Ícone Notificação com pop-up -->
    <div
      class="notificacao-wrapper"
      (mouseenter)="abrirNotificacao()"
      (mouseleave)="fecharNotificacao()"
      style="margin-right: 0.625rem"
    >
      <img
        src="assets/notificacao.png"
        alt="Notificações"
        class="notificacao"
        style="width: 2.25rem; cursor: pointer; transform: translateY(2px)"
      />

      <!-- Pop-up dinâmico -->
      <div class="notificacao-popup" *ngIf="mostrarNotificacoes">
        <div *ngFor="let n of notificacoes" class="notificacao-card">
          <div class="notificacao-imagem">
            <img
              [src]="n.imagemUrl"
              alt="Imagem"
              style="width: 100%; height: 100%"
            />
          </div>
          <div class="notificacao-conteudo">
            <strong>{{ n.titulo }}</strong>
            <small>{{ n.descricao }}</small>
          </div>
          <div
            *ngIf="usuarioService.usuarioEhAdmin()"
            style="
              display: flex;
              align-items: center;
              gap: 0.3rem;
              margin-left: auto;
            "
          >
            <span
              class="icone-acao editar notificacao"
              title="Editar notificação"
              style="font-size: 17px"
              (click)="editarNotificacao(n)"
              >✎</span
            >

            <span
              class="icone-acao apagar notificacao"
              title="Remover notificação"
              style="font-weight: bold"
              (click)="confirmarRemocao(n)"
              >✕</span
            >
          </div>
        </div>

        <div
          class="nova-notificacao"
          *ngIf="usuarioService.usuarioEhAdmin()"
          (click)="abrirFormularioNotificacao()"
        >
          + Nova notificação
        </div>
      </div>

      <!-- Formulário de criação (modal) -->
      <div
        class="formulario-modal"
        *ngIf="mostrarFormulario && usuarioService.usuarioEhAdmin()"
      >
        <h3 style="color: black; margin-top: 0">Nova Notificação</h3>

        <input
          type="text"
          [(ngModel)]="nova.titulo"
          class="form-control"
          placeholder="Título da notificação"
          style="width: 100%"
        />
        <textarea
          [(ngModel)]="nova.descricao"
          class="form-control"
          placeholder="Descrição da notificação"
          style="width: 100%; resize: none"
          rows="3"
        ></textarea>

        <input
          style="color: black"
          type="file"
          (change)="onFileChange($event)"
        />

        <div class="botoes-container">
          <button class="cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button
            class="salvar"
            (click)="salvarNotificacao()"
            [disabled]="
              !nova.titulo.trim() || !nova.descricao.trim() || !nova.imagemUrl
            "
          >
            Salvar
          </button>
        </div>
      </div>
    </div>

    <!-- Botão de menu ☰ -->
    <div
      class="dropdown"
      (mouseenter)="abrirMenu()"
      (mouseleave)="fecharMenu()"
    >
      <div class="dropdown-toggle">☰</div>
      <ul class="dropdown-menu" *ngIf="menuAberto">
        <li><a routerLink="/menu">Perfil</a></li>
        <li><a routerLink="/galeria">Galeria</a></li>
        <li><a routerLink="/produtos">Produtos</a></li>
        <li><a routerLink="/meus-horarios">Meus horarios</a></li>
        <li><a (click)="logout()">Sair</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="perfil-container">
  <!-- Imagem de perfil centralizada no topo -->
  <div class="avatar-wrapper">
    <img
      [src]="
        usuarioService.imagemUrl
          ? 'http://localhost:8080' + usuarioService.imagemUrl
          : 'assets/user-profile.png'
      "
      alt="Avatar"
      class="avatar-img"
      (click)="toggleEditarIconeMobile()"
      (mouseenter)="mostrarIconeDesktop = true"
      (mouseleave)="mostrarIconeDesktop = false"
    />
    <div
      class="edit-overlay"
      (click)="toggleEditarIconeMobile()"
      [ngClass]="{ 'mostrar-icone-mobile': mostrarIconeMobile && isMobile() }"
    >
      ✎
    </div>
  </div>

  <div class="perfil-info">
    <div class="campo" (click)="iniciarEdicao('nome')">
      <div class="label-container">
        <span class="label">Nome</span>
        <span class="edit-icon" *ngIf="!editandoNome && !isMobile()">✎</span>
      </div>
      <ng-container *ngIf="!editandoNome">
        <span class="valor">{{ usuarioService.nome || "Não informado" }}</span>
      </ng-container>
      <ng-container *ngIf="editandoNome">
        <input
          [(ngModel)]="tempNome"
          type="text"
          placeholder="Novo nome"
          (blur)="verificarEdicao('nome')"
          (ngModelChange)="onInputChange('nome')"
        />
        <div class="botoes-container" *ngIf="!isMobile()">
          <button (click)="salvarEdicao('nome')">Salvar</button>
          <button (click)="cancelarEdicao('nome')">Cancelar</button>
        </div>
      </ng-container>
    </div>
    <div class="campo" (click)="iniciarEdicao('sobrenome')">
      <div class="label-container">
        <span class="label">Sobrenome</span>
        <span class="edit-icon" *ngIf="!editandoSobrenome && !isMobile()"
          >✎</span
        >
      </div>
      <ng-container *ngIf="!editandoSobrenome">
        <span class="valor">{{
          usuarioService.sobrenome || "Não informado"
        }}</span>
      </ng-container>
      <ng-container *ngIf="editandoSobrenome">
        <input
          [(ngModel)]="tempSobrenome"
          type="text"
          placeholder="Novo sobrenome"
          (blur)="verificarEdicao('sobrenome')"
          (ngModelChange)="onInputChange('sobrenome')"
        />
        <div class="botoes-container" *ngIf="!isMobile()">
          <button (click)="salvarEdicao('sobrenome')">Salvar</button>
          <button (click)="cancelarEdicao('sobrenome')">Cancelar</button>
        </div>
      </ng-container>
    </div>
    <div class="campo" (click)="iniciarEdicao('telefone')">
      <div class="label-container">
        <span class="label">Telefone</span>
        <span class="edit-icon" *ngIf="!editandoTelefone && !isMobile()"
          >✎</span
        >
      </div>
      <ng-container *ngIf="!editandoTelefone">
        <span class="valor">{{
          usuarioService.telefone || "Não informado"
        }}</span>
      </ng-container>
      <ng-container *ngIf="editandoTelefone">
        <input
          [(ngModel)]="tempTelefone"
          type="text"
          placeholder="Novo telefone"
          (blur)="verificarEdicao('telefone')"
          (ngModelChange)="onInputChange('telefone')"
        />
        <div class="botoes-container" *ngIf="!isMobile()">
          <button (click)="salvarEdicao('telefone')">Salvar</button>
          <button (click)="cancelarEdicao('telefone')">Cancelar</button>
        </div>
      </ng-container>
    </div>
    <div class="campo" (click)="iniciarEdicao('email')">
      <div class="label-container">
        <span class="label">Email</span>
        <span class="edit-icon" *ngIf="!editandoEmail && !isMobile()">✎</span>
      </div>
      <ng-container *ngIf="!editandoEmail">
        <span class="valor">{{ usuarioService.email || "Não informado" }}</span>
      </ng-container>
      <ng-container *ngIf="editandoEmail">
        <input
          [(ngModel)]="tempEmail"
          type="email"
          placeholder="Novo email"
          (blur)="verificarEdicao('email')"
          (ngModelChange)="onInputChange('email')"
        />
        <div class="botoes-container" *ngIf="!isMobile()">
          <button (click)="salvarEdicao('email')">Salvar</button>
          <button (click)="cancelarEdicao('email')">Cancelar</button>
        </div>
      </ng-container>
    </div>
    <div class="campo" (click)="iniciarEdicao('senha')">
      <div class="label-container">
        <span class="label">Senha</span>
        <span class="edit-icon" *ngIf="!editandoSenha && !isMobile()">✎</span>
      </div>
      <ng-container *ngIf="!editandoSenha">
        <span class="valor">********</span>
      </ng-container>
      <ng-container *ngIf="editandoSenha">
        <input
          [(ngModel)]="tempSenha"
          type="password"
          placeholder="Nova senha"
          (blur)="verificarEdicao('senha')"
          (ngModelChange)="onInputChange('senha')"
        />
        <div class="botoes-container" *ngIf="!isMobile()">
          <button (click)="salvarEdicao('senha')">Salvar</button>
          <button (click)="cancelarEdicao('senha')">Cancelar</button>
        </div>
      </ng-container>
    </div>

    <div
      class="confirmacao-modal"
      *ngIf="mostrarConfirmacao && isMobile() && campoEditado"
    >
      <div class="modal-content">
        <h3>Salvar alterações?</h3>
        <p>
          Você editou o campo {{ campoEditado }}. Deseja salvar as alterações?
        </p>
        <div class="modal-botoes">
          <button class="btn-cancelar" (click)="cancelarEdicao(campoEditado)">
            Cancelar
          </button>
          <button class="btn-salvar" (click)="salvarEdicao(campoEditado)">
            Salvar
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL DE ALTERAR IMAGEM -->
    <div
      class="modal-overlay"
      *ngIf="mostrarConfirmacao && isMobile() && campoEditado"
    >
      <div class="confirmacao-modal">
        <div class="modal-content">
          <h3>Salvar alterações?</h3>
          <p>
            Você editou o campo {{ campoEditado }}. Deseja salvar as alterações?
          </p>
          <div class="modal-botoes">
            <button class="btn-cancelar" (click)="cancelarEdicao(campoEditado)">
              Cancelar
            </button>
            <button class="btn-salvar" (click)="salvarEdicao(campoEditado)">
              Salvar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- BARRA INFERIOR MOBILE -->
    <div class="bottom-nav">
      <a routerLink="/dashboard" class="nav-item">
        <img src="assets/inicio.png" alt="Início" width="38px" height="32px" />
        <span>Início</span>
      </a>
      <a routerLink="/galeria" class="nav-item">
        <img
          src="assets/galeria.png"
          alt="Galeria"
          width="34px"
          height="33px"
        />
        <span>Galeria</span>
      </a>
      <a routerLink="/agendamento" class="nav-item">
        <img
          src="assets/agendamento.png"
          alt="Agendamentos"
          width="34px"
          height="34px"
        />
        <span>Agendamentos</span>
      </a>
      <a routerLink="/produtos" class="nav-item">
        <img
          src="assets/produto.png"
          alt="Produtos"
          width="30px"
          height="30px"
        />
        <span>Produtos</span>
      </a>
      <a class="nav-item" (click)="abrirMenuMobile()">
        <img
          src="assets/user-profile.png"
          alt="Menu"
          width="40px"
          height="40px"
        />
        <span>Menu</span>
      </a>
    </div>

    <!-- POP-UP DE MENU MOBILE -->
    <div
      class="menu-mobile-popup"
      *ngIf="mostrarMenuMobile"
      (click)="fecharMenuMobile($event)"
    >
      <div class="menu-mobile-content" (click)="$event.stopPropagation()">
        <ul class="menu-mobile-lista">
          <li>
            <a routerLink="/perfil" (click)="fecharMenuMobile()">Perfil</a>
          </li>
          <li>
            <a routerLink="/meus-horarios" (click)="fecharMenuMobile()"
              >Meus horarios</a
            >
          </li>
          <li><a (click)="logout(); fecharMenuMobile()">Sair</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
